---
caption: API Design Guidelines
includeInBreadcrumbs: true
eleventyNavigation:
  parent: api-design-guidelines
---

# Linting Rules

## Overview

A linting ruleset was created to support API Developers/Providers in achieving the standards described in the [UKHSA API Guidelines][1], ensuring consistency, reliability, and security across all APIs developed within or on behalf of UKHSA. This ruleset is designed to be executed with [Vacuum][2], which avoids the `$ref` performance issues we've seen with other linters on large specs.

As well as the rules described herein, the UKHSA ruleset includes the [recommended][3] OpenAPI rules and the [documentation ruleset][5]. These are common sense rules that ensure an OpenAPI definition adheres to the [OpenAPI specification][6], as well as encourage high quality, rich documentation which is especially important for providing the best possible APIM Developer Portal experience.

Where rules been adopted from from existing open source API rulesets a link is supplied on the relevant rule page.

## How to use the rules

### Install Vacuum

[Vacuum][2] is a fast OpenAPI linter for rulesets like this one. Install Vacuum globally or as a dev dependency.

```sh
npm install @quobix/vacuum --save-dev
```

Read the [official Vacuum documentation][7] for more installation options.

### Run Vacuum against your OpenAPI definition

Run Vacuum against your OpenAPI definition, referencing the UKHSA ruleset. The custom rules rely on JavaScript functions, so build them first and pass the functions directory to Vacuum.

You must install the ruleset as via [npm package][8] and then reference that, bear in mind the UKHSA ruleset npm package is hosted in github so please read Github's documentation [Installing a GitHub npm package][9].

The simplest way to authenticate against the Github NPM registry locally is to use the npm login command (as described [here][10]) to authenticate with GitHub Packages, this adds the required credentials to your npm configuration file i.e. `.npmrc`.

```sh
$ npm login --scope=@ukhsa-collaboration --auth-type=legacy --registry=https://npm.pkg.github.com

Username: USERNAME #GITHUB USERNAME
Password: TOKEN #GITHUB PAT TOKEN
```

```sh
npm install @ukhsa-collaboration/spectral-rules --save-dev
```

Build the Vacuum-compatible functions (outputs to `dist-vacuum/functions`) and run the linter with the `--functions` flag so the custom rules load correctly.

```sh
npm run build:functions:cjs
npx vacuum lint openapi-definition.yml \
  -r ./node_modules/@ukhsa-collaboration/spectral-rules/ukhsa.oas.rules.yml \
  --functions ./node_modules/@ukhsa-collaboration/spectral-rules/dist-vacuum/functions
```

> [!TIP] Need a JSON report?
> Use `npx vacuum spectral-report <spec> <report.json>` to generate a report you can post-process in existing tooling.

### Review and fix any reported issues

Once the linter has highlighted any issues or errors, review and fix to ensure your OpenAPI definition remains compliant with the UKHSA guidelines.

### Severity overrides

Some OpenAPI definitions produced by platforms like [pygeoapi][11] might struggle to meet every **MUST** requirement. This is often because these issues are outside the consuming team's direct control, as fixes would require upstream contributions or maintaining a fork. To accommodate this, the pygeoapi ruleset relaxes the severity of certain rules when an OpenAPI document is identified as being generated by pygeoapi.

See [severity overrides][12] for more information.

> [!NOTE]
> Use the pygeoapi ruleset (`ukhsa.oas.rules.pygeoapi.yml`) or the wrapper script in `scripts/vacuum-lint.mjs` to select the correct ruleset based on `info.x-api-type`.

### CI/CD Github Actions

The following is a sample Github actions job which can be used as an example of setting up linting as part of you CI/CD pipeline.

<!-- {% raw %} -->

```yaml
...
---
name: API Standards Checks

on:
  pull_request:
    branches: [main, master] # Example only - you would typically use either 'main' or 'master', not both

jobs:
  lint-openapi:
    name: Lint OpenAPI
    runs-on: ubuntu-latest

    permissions:
      contents: read
      issues: read
      checks: write
      pull-requests: write
      packages: read

    steps:
      - name: Checkout code
        uses: actions/checkout@v5

      - uses: actions/setup-node@v6
        with:
          node-version: "22.x"
          registry-url: "https://npm.pkg.github.com"
          # Defaults to the user or organization that owns the workflow file
          scope: "@ukhsa-collaboration"

      - run: npm install @ukhsa-collaboration/spectral-rules
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Lint OpenAPI specifications
        run: |
          npx vacuum lint "*.{json,yml,yaml}" \
            -r ${{ GITHUB.WORKSPACE }}/node_modules/@ukhsa-collaboration/spectral-rules/ukhsa.oas.rules.yml \
            --functions ${{ GITHUB.WORKSPACE }}/node_modules/@ukhsa-collaboration/spectral-rules/dist-vacuum/functions

          # Example: Only lint OpenAPI files
          # npx vacuum lint "@(openapi|swagger|*api)*.{json,yml,yaml}" \
          #   -r ${{ GITHUB.WORKSPACE }}/node_modules/@ukhsa-collaboration/spectral-rules/ukhsa.oas.rules.yml \
          #   --functions ${{ GITHUB.WORKSPACE }}/node_modules/@ukhsa-collaboration/spectral-rules/dist-vacuum/functions
```

<!-- {% endraw %} -->

The above example uses [glob syntax][13] to target only OpenAPI specification files.

The glob pattern `@(openapi|swagger|*api)*.{json,yml,yaml}` matches:

> [!TIP] Matches
>
> ```text
> openapi.json
> something.api.yaml
> swagger.json
> ```

The global pattern does not match:

> [!CAUTION] Does Not Match
>
> ```text
> /node_modules/openapi.yaml
> /.git/something.json
> ```

### Additional Recommended Tooling

| Tool | Description |
| - | - |
| [Vacuum GitHub Action][14] | Official Vacuum action for linting OpenAPI definitions in CI/CD workflows. |
| [Vacuum VS Code Extension][15] | VS Code extension for running Vacuum linting locally. |

Read the [official Vacuum documentation][7] for more development workflows.

[1]: ../api-guidelines/index.md
[2]: https://quobix.com/vacuum/
[3]: https://docs.stoplight.io/docs/spectral/0a73453054745-recommended-or-all
[4]: https://docs.stoplight.io/docs/spectral/4dec24461f3af-open-api-rules
[5]: https://github.com/stoplightio/spectral-documentation
[6]: https://swagger.io/specification/
[7]: https://quobix.com/vacuum/installing/
[8]: https://meta.stoplight.io/docs/spectral/7895ff1196448-sharing-and-distributing-rulesets#npm
[9]: https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry#installing-a-package
[10]: https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-npm-registry#authenticating-with-a-personal-access-token
[11]: https://pygeoapi.io/
[12]: ./severity-overrides.md
[13]: https://github.com/mrmlnc/fast-glob
[14]: https://github.com/marketplace/actions/vacuum-openapi-linter-and-quality-analysis-tool
[15]: https://marketplace.visualstudio.com/items?itemName=pb33f.vacuum
